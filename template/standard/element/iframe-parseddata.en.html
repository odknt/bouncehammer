[%- SET IFRAMEHEIGHT = 144 -%]
[%- IF parsedmessages -%]
	[%- SET IFRAMEHEIGHT = ( IFRAMEHEIGHT + ( parsedmessages + 600 ) ) %]
[%- END -%]
[% IF onlineparse == 1 %]
	<body style = 'margin: 0; padding: 0; width: 585px;' 
		onLoad = "parent.document.getElementById('parseddata').style.height = '[% IFRAMEHEIGHT %]';
				parent.document.getElementById('doparse').value = 'Parse';"
		onAbort = "parent.document.getElementById('doparse').disabled = false;">
		
		[% prototype.define_javascript_functions %]
		<script type = 'text/javascript'>
			[% INCLUDE bouncehammer.js %]
		</script>
		<style type = 'text/css'>
		<!--
		html { overflow-x: hidden; overflow-y: auto; margin: 0; padding: 0; }
		[% INCLUDE bouncehammer.css %]
		[% INCLUDE record.css %]
		[% INCLUDE testparse.css %]
		[% INCLUDE reason.css %]
		-->
		</style>

		<h2>Parsed Message[%- IF parsedmessages > 1 -%]s[%- END -%]</h2>
		<div class = 'result' style = 'margin:0; padding: 0;'>
			<div class = 'upload-summary'>
				<table>
					<tbody>
						<tr>
							<td class = 'key'>Data source</td>
							<td class = 'value'>[% parsedfilename %] </td>
							<td class = 'extra'> </td>
						</tr>

						<tr>
							<td class = 'key'>Data size</td>
							<td class = 'value'>
								[% IF parseerror == "toobig" %]
									<span class = 'errortext'>Exceed limit</span>
								[% ELSIF parseerror == "nottext" %]
									? Bytes
								[% ELSE %]
									about [% parsedfilesize %] Bytes
								[% END %]
							</td>
							<td class = 'extra'> </td>
						</tr>

						<tr>
							<td class = 'key'>Messages</td>
							<td class = 'value'>[% parsedmessages %]</td>
							<td class = 'extra'> </td>
						</tr>

						[% IF onlineupdate == 1 AND parseerror == '' %]
							<tr>
								<td class = 'key'>Registered</td>
								<td class = 'value'>[% updateresult.insert %]</td>
								<td class = 'extra'></td>
							</tr>

							<tr>
								<td class = 'key'>Updated</td>
								<td class = 'value'>[% updateresult.update %]</td>
								<td class = 'extra'></td>
							</tr>

							<tr>
								<td class = 'key'>Skipped</td>
								<td class = 'value'>
									No SenderDomain: [% updateresult.nofrom %],
									Too Old or Same: [% updateresult.tooold %],
									Is Whitelisted:  [% updateresult.whited %],
									Exceeds Limit:   [% updateresult.exceed %]
									Failed: [% updateresult.failed %]
								</td>
								<td class = 'extra'></td>
							</tr>
						[% END %]
					</tbody>
				</table>
			</div>

			[%- IF parsedmessages -%]
				[% IF outputformat == "html" %]
					[% INCLUDE "div-result.${mylanguage}.html" %]
				[% ELSE %]
					<textarea name = 'serialized' id = 'serialized' class = 'serialized'
						rows = '22' cols = '87' readonly = 'readonly'>[% parseddatatext %]</textarea>
				[% END %]
			[%- ELSE -%]
				<div class = 'errormessage'>
				[%- IF parseerror == "toobig" -%]
					File size too big.
				[%- ELSIF parseerror == "nottext" %]
					File is not email(text) file.
				[%- ELSE -%]
					No bounce message in the e-mail or the mailbox.
				[%- END -%]
				</div>
			[%- END -%]
		</div>
	</body>
[% END %]
